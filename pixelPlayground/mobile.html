<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9, user-scalable=1" />
		<meta charset="utf-8">

		<title>Mobile Controller</title>

		<style>

			html, body { 
				margin: 0; 
				padding: 0; 
			}

			#container {
				margin: 0;
				padding: 0;
				text-align: center;
			}

			#log {
				margin: auto;
				width: 100%;
			}

			#yourchar {
				margin: auto;
				width: 100%;
			}

			#arrow {
				margin: auto;
				width: 100%;
			}

		</style>
	</head>

<body>

	<div id="container">

		<div id="log"></div>
		<img id="yourchar"></img>
		<img id="arrow"></img>

		<!--
		<ul>
	  		<li>alpha: <span id="alpha"></span></li>
	    	<li>beta: <span id="beta"></span></li>
	    	<li>gamma: <span id="gamma"></span></li>
	    	<li>Z acc: <span id="accz"></span></li>
	    	<li>touches: <span id="touch-count"></span></li>
		</ul>
		!-->

	</div>

	<audio id="jump">
		<source src="http://itp.nyu.edu/~jab680/assets/jump.wav" type="audio/wav">
	</audio>

<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
	
	var socket = io.connect('http://ec2-54-200-21-97.us-west-2.compute.amazonaws.com:8080/');
	var socketId = null;
	var player = null;
	var number = null;

	var characterImageSources = 10;
	var characterImages = [];

	for (i = 0; i < characterImageSources; i++) {
		characterImages[i] = "http://itp.nyu.edu/~jab680/assets/char" + [i] + "_mobile.png";
	}

	var jump = document.getElementById("jump");

	var allTouches, allTouchesLength;

	socket.on('connect', function() {
		socketId = socket.socket.sessionid;
		//socket.emit('playerConnect');
	});

	socket.on('players', function (data) {
		if (data.socketId === socketId) {
			player = data.type;
			number = player.slice(6);

			// for (i = 0; i < characterImageSources; i++) {
			// 	if (number == i) {
			// 		document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
			// 		document.getElementById("yourchar").src = characterImages[i];
			// 	}
			// }

			if (number == 0) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[number];
			}

			else if (number == 1) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[number];
			}

			else if (number == 2) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[number];
			}

			else if (number == 3) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[number];
			}

			else if (number == 4) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[number];
			}

			else if (number == 5) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[number];
			}

			else if (number == 6) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[number];
			}

			else if (number == 7) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[number];
			}

			else if (number == 8) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[number];
			}

			else if (number == 9) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[number];
			}

			else if (number == 10) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[0];
			}

			else if (number == 11) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[1];
			}

			else if (number == 12) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[2];
			}

			else if (number == 13) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[3];
			}

			else if (number == 14) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[4];
			}

			else if (number == 15) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[5];
			}

			else if (number == 16) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[6];
			}

			else if (number == 17) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[7];
			}

			else if (number == 18) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[8];
			}

			else if (number == 19) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[9];
			}

			else if (number == 20) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[0];
			}

			else if (number == 21) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[1];
			}

			else if (number == 22) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[2];
			}

			else if (number == 23) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[3];
			}

			else if (number == 24) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[4];
			}

			else if (number == 25) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[5];
			}

			else if (number == 26) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[6];
			}

			else if (number == 27) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[7];
			}

			else if (number == 28) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[8];
			}

			else if (number == 29) {
				document.getElementById("log").innerHTML = "<h1>You are Player " + number + "</h1>";
				document.getElementById("yourchar").src = characterImages[9];
			}

			socket.emit('playerConnect', {"id": number});
		}
	});

	var sendMove = function(direction) {
		socket.emit('move', {"id": number, "direction": direction});
	}

	var handleOrientationEvent = function(e) {
		alpha = e.alpha;
		beta = e.beta;
		gamma = e.gamma;

		if (gamma > 60) { 
			gamma = 60;
		}

		if (gamma < -60) {
			gamma = -60;
		}

		// console.log('a: ' + alpha + 'b: ' + beta + 'g: ' + gamma);
		// var a = document.getElementById('alpha');
		// a.innerHTML = alpha;
		// var b = document.getElementById('beta');
		// b.innerHTML = beta;
		// var g = document.getElementById('gamma');
		// g.innerHTML = gamma;

		if (allTouchesLength >= 1) {

			if (gamma > 35) {
				sendMove('right');
				document.getElementById("arrow").src = "http://itp.nyu.edu/~jab680/assets/rightarrow.png";
			}

			if (gamma < -35) {
				sendMove('left');
				document.getElementById("arrow").src = "http://itp.nyu.edu/~jab680/assets/leftarrow.png";

			}
		}
	}

	var handleMotionEvent = function(e) {
		acc = e.acceleration;
		maxAcc = Math.max(acc.x, acc.y, acc.z);

		// var accz = document.getElementById('accz');
		// accz.innerHTML = acc.z;

		if (acc.z > 7.0) {
			acc.z = 7.0;
		}

		if (allTouchesLength >=1 ) {

			if (acc.z > 5.0) {
				sendMove('up');
				jump.play();
			}
		}
	}

	var handleTouchEvent = function(e) {
		allTouches = e.touches;
		allTouchesLength = allTouches.length;

		var touchCountElem = document.getElementById('touch-count');

		if (e.type === 'touchstart') {
			e.preventDefault();
		}

		if (allTouchesLength = 2) {
			sendMove('flip');
		}

		touchCountElem.innerHTML = allTouchesLength;
	}

	window.addEventListener('devicemotion', handleMotionEvent, false);
	window.addEventListener('deviceorientation', handleOrientationEvent, false);
	window.addEventListener('touchstart', handleTouchEvent, false);
	window.addEventListener('touchend', handleTouchEvent, false);

</script>
</body>
</html>