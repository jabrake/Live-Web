<html>
	<head>
		<style type="text/css">
			.pixelimage{
				position: absolute;
				left: 10px;
				top: 10px;
				width: 10%;
				height: auto;
			}
		</style>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript">
		
			var socket = io.connect('http://ec2-54-200-21-97.us-west-2.compute.amazonaws.com:8080/');

			var myId;
			var characterImagesSources = 7;
			var characterImages = new Array();
			var characters = new Array();

			for (i = 0; i < characterImagesSources; i++) {
				characterImages[i] = "http://itp.nyu.edu/~jab680/assets/pixel" + [i] + ".png";
			}

			for (i = 0; i < characterImages.length; i++) {
				characters[i] = document.createElement("img");
				characters[i].setAttribute("src", characterImages[i]);
				characters[i].className += "pixelimage";
				characters[i].id = "pixel" + i;
			}
			
			socket.on('connect', function() {
				console.log("Connected");
			});

			socket.on('set_id', function (data) {
				console.log("myId", data);

				myId = data;
				idCounter = myId+1;

				for (i = 0; i < idCounter; i++) {
					if (myId == i) {
						document.body.appendChild(characters[i]);
						console.log("Created character with ID: " + myId);
					}
				}
			});

			// Receive from any event
			socket.on('othermouse', function (data) {

				seeMoves(data.x,data.y, data.id);

			});
			
			var sendmouse = function(xval, yval) {
				//console.log("sendmouse: " + xval + " " + yval);
				socket.emit('othermouse',{ x: xval, y: yval, id: myId });
			};

			var canvas;
			var context;

			var init = function() {

				document.addEventListener('mousemove', function (evt) {

					x = evt.clientX;
					y = evt.clientY;

					sendmouse(x,y);
					moveChar(x,y);

				}, false);

			};
	
			var moveChar = function (xval,yval) {

				idCounter = myId+1;
				
				for (i = 0; i < idCounter; i++) {
					if (myId == i) {
						characters[i].style.left = xval;
						characters[i].style.top = yval;
					}
				}
			};
	
			var seeMoves = function (xval,yval,id) {

				idCounter = myId+1;

				for (i = 0; i < idCounter; i++) {
					if (myId == i) {
						characters[i].style.left = xval;
						characters[i].style.top = yval;
					}
				}
			};
	
		</script>			
	</head>

	<body onload="init();">
	
	</body>
</html>